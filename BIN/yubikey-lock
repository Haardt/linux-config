#!/usr/bin/env bash

set -ex

# To prevent accidental locking
sleep 1

if lsusb | grep -E '1050:(0407|0116)' &> /dev/null
then
  exit 0
fi

for i3id in $(pgrep -x i3)
do
  uid="$(stat -c %u /run/user/*/i3/ipc-socket.$i3id)"
  i3-msg -s /run/user/$uid/i3/ipc-socket.$i3id exec /usr/local/bin/custom/lock
done
